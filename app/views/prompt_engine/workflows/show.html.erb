<div class="admin-header">
  <h1><%= @workflow.name %></h1>
  <div class="admin-header__actions">
    <%= link_to "Test in Playground", playground_workflow_path(@workflow), class: "btn btn--success btn--medium" %>
    <%= link_to "Edit", edit_workflow_path(@workflow), class: "btn btn--primary btn--medium" %>
    <%= link_to "Back to Workflows", workflows_path, class: "btn btn--neutral btn--medium" %>
  </div>
</div>

<div class="card">
  <div class="card__header">
    <h2>Workflow Details</h2>
  </div>
  <div class="card__body">
    <div class="form__group">
      <label class="form__label">Name</label>
      <div class="form__static"><%= @workflow.name %></div>
    </div>

    <div class="form__group">
      <label class="form__label">Created</label>
      <div class="form__static">
        <%= @workflow.created_at.strftime("%B %d, %Y at %I:%M %p") %>
        (<%= time_ago_in_words(@workflow.created_at) %> ago)
      </div>
    </div>

    <% if @workflow.updated_at != @workflow.created_at %>
      <div class="form__group">
        <label class="form__label">Last Updated</label>
        <div class="form__static">
          <%= @workflow.updated_at.strftime("%B %d, %Y at %I:%M %p") %>
          (<%= time_ago_in_words(@workflow.updated_at) %> ago)
        </div>
      </div>
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card__header">
    <h2>Workflow Steps</h2>
    <div class="text-sm text-muted">
      Steps are executed in order. Each step's output becomes the input for the next step.
    </div>
  </div>
  <div class="card__body">
    <% if @workflow.steps.present? %>
      <div class="workflow-steps">
        <% @workflow.steps.sort.each_with_index do |(step_key, prompt_slug), index| %>
          <% prompt = PromptEngine::Prompt.find_by(slug: prompt_slug) %>
          <div class="workflow-step">
            <div class="workflow-step__number">
              <%= index + 1 %>
            </div>
            <div class="workflow-step__content">
              <div class="workflow-step__header">
                <h4 class="workflow-step__title">
                  <% if prompt %>
                    <%= link_to prompt.name, prompt_path(prompt), class: "link" %>
                  <% else %>
                    <span class="text-danger">Missing Prompt</span>
                  <% end %>
                </h4>
                <code class="workflow-step__slug"><%= prompt_slug %></code>
              </div>
              <% if prompt %>
                <div class="workflow-step__description">
                  <% if prompt.description.present? %>
                    <%= prompt.description %>
                  <% else %>
                    <span class="text-muted">No description</span>
                  <% end %>
                </div>
                <div class="workflow-step__variables">
                  <strong>Variables:</strong>
                  <% if index == 0 %>
                    Initial variables will be passed to this step
                  <% else %>
                    <code>{{output}}</code> from previous step
                  <% end %>
                </div>
              <% else %>
                <div class="alert alert--danger">
                  <strong>Error:</strong> Prompt "<%= prompt_slug %>" not found. 
                  This workflow may not execute correctly.
                </div>
              <% end %>
            </div>
            <% unless index == @workflow.steps.size - 1 %>
              <div class="workflow-step__arrow">‚Üì</div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <div class="empty-state__icon">üìù</div>
        <h3 class="empty-state__title">No steps defined</h3>
        <p class="empty-state__description">
          Add steps to this workflow to chain prompts together.
        </p>
        <%= link_to "Edit Workflow", edit_workflow_path(@workflow), class: "btn btn--primary btn--medium" %>
      </div>
    <% end %>
  </div>
</div>

<% if @workflow.steps.present? %>
  <div class="card">
    <div class="card__header">
      <h2>Usage Example</h2>
    </div>
    <div class="card__body">
      <div class="code-block">
        <pre><code># Execute workflow and get final result
result = PromptEngine.workflow("<%= @workflow.name %>", 
  variable1: "value1",
  variable2: "value2"
)

# Execute workflow and get detailed step results  
detailed_result = PromptEngine.workflow_with_steps("<%= @workflow.name %>",
  variable1: "value1", 
  variable2: "value2"
)

# detailed_result will include:
# {
<% @workflow.steps.sort.each do |step_key, prompt_slug| %>
#   "<%= prompt_slug %>_output" => "...",
<% end %>
#   "result" => "final output"
# }</code></pre>
      </div>
    </div>
  </div>
<% end %>

<div class="admin-actions">
  <%= link_to "Edit Workflow", edit_workflow_path(@workflow), class: "btn btn--primary btn--medium" %>
  <%= link_to "Delete Workflow", workflow_path(@workflow), 
      method: :delete,
      data: { 
        confirm: "Are you sure you want to delete this workflow? This action cannot be undone." 
      },
      class: "btn btn--danger btn--medium" %>
  <%= link_to "Back to Workflows", workflows_path, class: "btn btn--neutral btn--medium" %>
</div>
