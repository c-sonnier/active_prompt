<div class="admin-header">
  <h1>Workflows</h1>
  <%= link_to "New Workflow", new_workflow_path, class: "btn btn--primary btn--medium" %>
</div>

<div class="table-container">
  <% if @workflows.any? %>
    <table class="table">
      <thead>
        <tr class="table__row">
          <th class="table__cell table__cell--header">Name</th>
          <th class="table__cell table__cell--header table__cell--hide-mobile">Steps</th>
          <th class="table__cell table__cell--header table__cell--hide-mobile">Created</th>
          <th class="table__cell table__cell--header table__cell--actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @workflows.each do |workflow| %>
          <tr class="table__row">
            <td class="table__cell">
              <%= link_to workflow.name, workflow_path(workflow), class: "link" %>
            </td>
            <td class="table__cell table__cell--hide-mobile">
              <% if workflow.steps.present? %>
                <div class="text-sm">
                  <%= workflow.steps.size %> step<%= workflow.steps.size == 1 ? '' : 's' %>
                  <div class="text-muted">
                    <% workflow.steps.sort.first(3).each do |step_key, prompt_slug| %>
                      <span class="badge badge--neutral badge--sm"><%= prompt_slug %></span>
                    <% end %>
                    <% if workflow.steps.size > 3 %>
                      <span class="text-muted">+<%= workflow.steps.size - 3 %> more</span>
                    <% end %>
                  </div>
                </div>
              <% else %>
                <span class="text-muted">No steps</span>
              <% end %>
            </td>
            <td class="table__cell table__cell--hide-mobile">
              <span class="text-sm text-muted">
                <%= time_ago_in_words(workflow.created_at) %> ago
              </span>
            </td>
            <td class="table__cell table__cell--actions">
              <div class="action-buttons">
                <%= link_to "Test", playground_workflow_path(workflow), class: "btn btn--success btn--small" %>
                <%= link_to "View", workflow_path(workflow), class: "btn btn--neutral btn--small" %>
                <%= link_to "Edit", edit_workflow_path(workflow), class: "btn btn--neutral btn--small" %>
                <%= link_to "Delete", workflow_path(workflow), 
                    method: :delete,
                    data: { 
                      confirm: "Are you sure you want to delete this workflow? This action cannot be undone." 
                    },
                    class: "btn btn--danger btn--small" %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <div class="empty-state">
      <div class="empty-state__icon">
        ðŸ“‹
      </div>
      <h3 class="empty-state__title">No workflows yet</h3>
      <p class="empty-state__description">
        Workflows allow you to chain prompts together, where the output of one prompt becomes the input of the next.
      </p>
      <%= link_to "Create your first workflow", new_workflow_path, class: "btn btn--primary btn--medium" %>
    </div>
  <% end %>
</div>
